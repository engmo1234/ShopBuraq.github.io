<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    
    <!-- ====== ENHANCED SEO META TAGS ====== -->
    <title>BURΔQ | Cyber River Fashion - Premium Phygital Fashion & NFT Wearables</title>
    <meta name="description" content="BURΔQ - Cyberpunk fashion meets blockchain technology. Navigate digital rivers in our premium speedboat experience with exclusive NFT fashion drops. Experience the future of phygital fashion.">
    <meta name="keywords" content="cyberpunk fashion, NFT wearables, blockchain fashion, phygital clothing, digital river, speedboat experience, crypto fashion, digital collectibles">
    <meta name="author" content="BURΔQ Fashion">
    <meta property="og:title" content="BURΔQ | Cyber River Fashion">
    <meta property="og:description" content="Navigate the digital currents of cyberpunk fashion with BURΔQ. Exclusive NFT fashion drops and premium phygital experiences.">
    <meta property="og:image" content="https://burq-fashion.com/preview.jpg">
    <meta property="og:url" content="https://burq-fashion.com">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="BURΔQ | Cyber River Fashion">
    <meta name="twitter:description" content="Premium cyberpunk fashion meets blockchain technology. Exclusive NFT drops.">
    <link rel="canonical" href="https://burq-fashion.com">
    
    <!-- ====== STRUCTURED DATA FOR SEO ====== -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": "BURΔQ Cyber River Fashion",
        "description": "Cyberpunk phygital fashion with NFT integration",
        "brand": {
            "@type": "Brand",
            "name": "BURΔQ"
        },
        "offers": {
            "@type": "AggregateOffer",
            "offerCount": "3",
            "lowPrice": "0.08",
            "highPrice": "0.25",
            "priceCurrency": "ETH"
        }
    }
    </script>
    
    <!-- ====== FAVICONS ====== -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <link rel="manifest" href="site.webmanifest">
    
    <!-- ====== FONTS & ICONS ====== -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- ====== THREE.JS ====== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/FXAAShader.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow: hidden; touch-action: manipulation; }
        body { 
            font-family: 'Rajdhani', sans-serif;
            background: #000;
            color: white;
            position: relative;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* CANVAS CONTAINER */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* PRELOADER */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s;
        }
        
        .preloader-content {
            text-align: center;
        }
        
        .preloader-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 5rem;
            font-weight: 900;
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 2rem;
            animation: logoGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes logoGlow {
            from { filter: drop-shadow(0 0 10px rgba(0,240,255,0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(157,0,255,0.7)); }
        }
        
        .loading-bar {
            width: 300px;
            height: 3px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #00f0ff, #9d00ff);
            animation: loading 3s ease-in-out forwards;
        }
        
        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        
        /* NAVIGATION */
        .nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1.5rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 20;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0,240,255,0.2);
        }
        
        .nav-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-decoration: none;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            font-family: 'Orbitron', sans-serif;
            font-weight: 500;
            position: relative;
            padding: 0.5rem 0;
            transition: color 0.3s;
        }
        
        .nav-link:hover {
            color: #00f0ff;
        }
        
        .wallet-btn {
            padding: 0.8rem 2rem;
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            border: none;
            border-radius: 30px;
            color: black;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .wallet-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,240,255,0.3);
        }
        
        /* HERO SECTION */
        .hero {
            position: absolute;
            top: 50%;
            left: 5%;
            transform: translateY(-50%);
            max-width: 600px;
            z-index: 15;
            pointer-events: none;
        }
        
        .hero-badge {
            display: inline-block;
            padding: 1rem 2rem;
            background: rgba(0,0,0,0.5);
            border: 1px solid #00f0ff;
            border-radius: 50px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 3px;
            margin-bottom: 3rem;
            backdrop-filter: blur(10px);
            pointer-events: auto;
        }
        
        .hero-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 5rem;
            font-weight: 900;
            line-height: 1;
            margin-bottom: 2rem;
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(0,240,255,0.3);
        }
        
        .hero-subtitle {
            font-size: 1.5rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 4rem;
            line-height: 1.6;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            pointer-events: auto;
        }
        
        .btn {
            padding: 1.2rem 2.5rem;
            border-radius: 50px;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            color: black;
            box-shadow: 0 10px 30px rgba(0,240,255,0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,240,255,0.5);
        }
        
        /* STATS OVERLAY */
        .stats-overlay {
            position: fixed;
            bottom: 5%;
            right: 5%;
            display: flex;
            gap: 2rem;
            z-index: 15;
        }
        
        .stat-item {
            text-align: center;
            background: rgba(0,0,0,0.5);
            padding: 1.5rem 2rem;
            border-radius: 15px;
            border: 1px solid rgba(0,240,255,0.2);
            backdrop-filter: blur(10px);
            min-width: 120px;
        }
        
        .stat-number {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            margin-top: 0.5rem;
        }
        
        /* CONTROL INFO */
        .controls-info {
            position: fixed;
            bottom: 5%;
            left: 5%;
            background: rgba(0,0,0,0.5);
            padding: 1rem 2rem;
            border-radius: 15px;
            border: 1px solid rgba(0,240,255,0.2);
            backdrop-filter: blur(10px);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            max-width: 300px;
            z-index: 15;
        }
        
        /* ====== EXPANDABLE/MINIMIZABLE WEATHER BOX ====== */
        .weather-control {
            position: fixed;
            top: 15%;
            left: 5%;
            background: rgba(0,0,0,0.85);
            border: 1px solid rgba(0,240,255,0.3);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            z-index: 15;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            min-width: 220px;
            box-shadow: 0 8px 32px rgba(0, 240, 255, 0.1);
        }
        
        .weather-control.minimized {
            height: 50px;
            width: 180px;
        }
        
        .weather-control.minimized .weather-content {
            opacity: 0;
            height: 0;
            padding: 0;
            pointer-events: none;
        }
        
        .weather-header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            background: linear-gradient(90deg, rgba(0,240,255,0.1), rgba(157,0,255,0.1));
            border-bottom: 1px solid rgba(0,240,255,0.2);
        }
        
        .weather-header h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: #00f0ff;
            margin: 0;
        }
        
        .weather-toggle {
            background: none;
            border: none;
            color: #00f0ff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.3s;
            padding: 4px;
            border-radius: 4px;
        }
        
        .weather-toggle:hover {
            background: rgba(0,240,255,0.1);
            transform: rotate(90deg);
        }
        
        .weather-content {
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .weather-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            outline: none;
            margin: 10px 0;
        }
        
        .weather-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #00f0ff;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .weather-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .weather-btn {
            padding: 0.5rem 1rem;
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(0,240,255,0.3);
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
        }
        
        .weather-btn.active {
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            color: black;
        }
        
        /* BOAT CONTROL PANEL */
        .boat-control {
            position: fixed;
            top: 15%;
            right: 5%;
            background: rgba(0,0,0,0.7);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(0,240,255,0.2);
            backdrop-filter: blur(10px);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 15;
            width: 220px;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .control-btn {
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.7);
            border: 1px solid rgba(0,240,255,0.3);
            border-radius: 10px;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
        }
        
        .control-btn:hover, .control-btn:active {
            background: rgba(0,240,255,0.2);
        }
        
        .control-btn:active {
            background: rgba(0,240,255,0.5);
            transform: scale(0.95);
        }
        
        .speed-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* DIRECTION INDICATOR */
        .direction-indicator {
            position: fixed;
            top: 12%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 1rem 2rem;
            border-radius: 15px;
            border: 1px solid rgba(0,240,255,0.2);
            backdrop-filter: blur(10px);
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 15;
        }
        
        .direction-arrow {
            font-size: 2rem;
            color: #00f0ff;
        }
        
        /* TOUCH JOYSTICK FOR MOBILE */
        .touch-joystick-container {
            position: fixed;
            bottom: 120px;
            left: 30px;
            width: 120px;
            height: 120px;
            z-index: 15;
            display: none;
            touch-action: none;
        }
        
        .touch-joystick-base {
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            border: 2px solid rgba(0,240,255,0.3);
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        .touch-joystick-handle {
            position: absolute;
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(0,240,255,0.5);
        }
        
        /* SPEED TOUCH CONTROL FOR MOBILE */
        .touch-speed-control {
            position: fixed;
            bottom: 120px;
            right: 30px;
            width: 80px;
            height: 180px;
            z-index: 15;
            display: none;
            touch-action: none;
        }
        
        .touch-speed-track {
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            border-radius: 40px;
            border: 2px solid rgba(0,240,255,0.3);
            position: relative;
            backdrop-filter: blur(10px);
        }
        
        .touch-speed-slider {
            position: absolute;
            width: 70px;
            height: 70px;
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            border-radius: 50%;
            left: 50%;
            transform: translateX(-50%);
            top: 10px;
            box-shadow: 0 0 20px rgba(0,240,255,0.5);
        }
        
        /* GESTURE HINT */
        .gesture-hint {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid rgba(0,240,255,0.3);
            backdrop-filter: blur(10px);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: #00f0ff;
            text-align: center;
            z-index: 15;
            display: none;
            animation: pulseHint 2s infinite;
        }
        
        @keyframes pulseHint {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }
        
        /* NFT SHOP WINDOW */
        .shop-window {
            position: fixed;
            top: 50%;
            right: -400px;
            transform: translateY(-50%);
            width: 350px;
            background: rgba(0,0,0,0.9);
            padding: 2rem;
            border-radius: 20px;
            border: 1px solid #00f0ff;
            backdrop-filter: blur(20px);
            z-index: 20;
            transition: right 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .shop-window.active {
            right: 5%;
        }
        
        .shop-toggle {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: linear-gradient(45deg, #00f0ff, #9d00ff);
            color: black;
            padding: 1rem;
            border-radius: 10px 0 0 10px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            z-index: 19;
        }
        
        .nft-item {
            background: rgba(20,20,30,0.8);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(0,240,255,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .nft-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,240,255,0.2);
        }
        
        .nft-price {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: #00f0ff;
            margin: 1rem 0;
        }
        
        /* SNOWFLAKES OVERLAY */
        .snowflakes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            filter: blur(0.5px);
        }
        
        /* RESPONSIVE DESIGN */
        @media (max-width: 1200px) {
            .hero-title { font-size: 4rem; }
            .stats-overlay { gap: 1rem; }
            .stat-item { padding: 1rem 1.5rem; }
        }
        
        @media (max-width: 1024px) {
            .hero { max-width: 500px; }
            .hero-title { font-size: 3.5rem; }
            .hero-subtitle { font-size: 1.3rem; }
            
            .weather-control, .boat-control {
                width: 200px;
                padding: 1rem;
            }
        }
        
        /* TABLET STYLES */
        @media (max-width: 900px) and (min-width: 769px) {
            .hero {
                left: 2%;
                max-width: 400px;
            }
            
            .hero-title { font-size: 3rem; }
            .hero-subtitle { font-size: 1.2rem; margin-bottom: 3rem; }
            
            .stats-overlay {
                bottom: 10%;
                right: 2%;
            }
            
            .controls-info {
                left: 2%;
                bottom: 10%;
                font-size: 0.8rem;
                padding: 0.8rem 1.5rem;
            }
            
            .weather-control, .boat-control {
                top: 20%;
                width: 180px;
            }
            
            .touch-joystick-container, .touch-speed-control, .gesture-hint {
                display: block;
            }
        }
        
        /* MOBILE STYLES */
        @media (max-width: 768px) {
            .hero {
                top: 40%;
                left: 5%;
                right: 5%;
                max-width: 100%;
                text-align: center;
            }
            
            .hero-title { 
                font-size: 2.5rem;
                margin-bottom: 1.5rem;
            }
            
            .hero-subtitle { 
                font-size: 1.1rem;
                margin-bottom: 2.5rem;
            }
            
            .hero-badge {
                font-size: 0.8rem;
                padding: 0.8rem 1.5rem;
                margin-bottom: 2rem;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .btn {
                padding: 1rem 2rem;
                font-size: 1rem;
            }
            
            /* Hide desktop controls */
            .controls-info, .weather-control, .boat-control, .direction-indicator {
                display: none;
            }
            
            /* Show mobile controls */
            .touch-joystick-container, .touch-speed-control, .gesture-hint {
                display: block;
            }
            
            .stats-overlay {
                bottom: 20%;
                right: 5%;
                left: 5%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .stat-item {
                padding: 1rem;
                min-width: 100px;
            }
            
            .stat-number {
                font-size: 1.8rem;
            }
            
            .nav {
                padding: 1rem 5%;
            }
            
            .nav-logo {
                font-size: 1.5rem;
            }
            
            .nav-links {
                display: none;
            }
            
            .wallet-btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
            }
            
            .shop-window {
                width: 90%;
                right: -100%;
                padding: 1.5rem;
            }
            
            .shop-window.active {
                right: 5%;
            }
            
            .shop-toggle {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .hero-title { font-size: 2rem; }
            .hero-subtitle { font-size: 1rem; }
            .touch-joystick-container { left: 15px; bottom: 100px; }
            .touch-speed-control { right: 15px; bottom: 100px; }
            .gesture-hint { font-size: 0.8rem; padding: 8px 16px; }
        }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 0; }
        
        /* ANIMATIONS */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .floating { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body>
    <!-- CANVAS CONTAINER -->
    <div id="canvas-container"></div>
    
    <!-- SNOWFLAKES OVERLAY -->
    <div class="snowflakes" id="snowflakes"></div>
    
    <!-- PRELOADER -->
    <div class="preloader" id="preloader">
        <div class="preloader-content">
            <div class="preloader-logo">BURΔQ</div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>
    
    <!-- NAVIGATION -->
    <nav class="nav">
        <a href="#" class="nav-logo">BURΔQ</a>
        <div class="nav-links">
            <a href="#shop" class="nav-link">SHOP</a>
            <a href="#" class="nav-link">COLLECTION</a>
            <a href="#" class="nav-link">ABOUT</a>
            <a href="#" class="nav-link">CONTACT</a>
        </div>
        <button class="wallet-btn" id="connectWallet">
            <i class="fas fa-wallet"></i> CONNECT WALLET
        </button>
    </nav>
    
    <!-- HERO -->
    <section class="hero">
        <div class="hero-badge floating">PHYGITAL FASHION DROP #001</div>
        <h1 class="hero-title">RIDE THE<br>DIGITAL RIVER</h1>
        <p class="hero-subtitle">
            Where cyberpunk fashion meets blockchain technology. 
            Each garment is a token, each token tells a story. 
            Navigate the digital currents with us.
        </p>
        <div class="button-grid">
            <button class="btn btn-primary" id="shopToggle">
                <i class="fas fa-store"></i> OPEN SHOP
            </button>
            <button class="btn btn-primary" id="speedUp">
                <i class="fas fa-tachometer-alt"></i> INCREASE SPEED
            </button>
        </div>
    </section>
    
    <!-- STATS -->
    <div class="stats-overlay">
        <div class="stat-item">
            <div class="stat-number" id="boatSpeed">75</div>
            <div class="stat-label">KM/H</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="weatherIntensity">2500</div>
            <div class="stat-label">PARTICLES</div>
        </div>
        <div class="stat-item">
            <div class="stat-number" id="distance">0.0</div>
            <div class="stat-label">KM TRAVELED</div>
        </div>
    </div>
    
    <!-- DIRECTION INDICATOR -->
    <div class="direction-indicator">
        <div>BOAT POSITION</div>
        <div class="direction-arrow" id="directionArrow">↓</div>
        <div id="riverPosition">Z: 0.0</div>
    </div>
    
    <!-- CONTROLS INFO -->
    <div class="controls-info">
        <div>←→ ARROW KEYS: STEER BOAT</div>
        <div>↑↓ ARROW KEYS: MOVE UP/DOWN RIVER</div>
        <div>SPACEBAR: NITRO BOOST</div>
        <div>W/S: MOVE FORWARD/BACKWARD</div>
        <div>SCROLL: ZOOM IN/OUT</div>
    </div>
    
    <!-- MOBILE TOUCH CONTROLS -->
    <div class="touch-joystick-container" id="touchJoystick">
        <div class="touch-joystick-base">
            <div class="touch-joystick-handle" id="joystickHandle"></div>
        </div>
    </div>
    
    <div class="touch-speed-control" id="touchSpeedControl">
        <div class="touch-speed-track">
            <div class="touch-speed-slider" id="speedSlider"></div>
        </div>
    </div>
    
    <div class="gesture-hint" id="gestureHint">
        <i class="fas fa-hand-point-up"></i> Use joystick to steer, slider for speed
    </div>
    
    <!-- WEATHER CONTROL - EXPANDABLE/MINIMIZABLE -->
    <div class="weather-control" id="weatherControl">
        <div class="weather-header" id="weatherToggle">
            <h3><i class="fas fa-cloud-sun"></i> WEATHER CONTROL</h3>
            <button class="weather-toggle" id="weatherToggleBtn">
                <i class="fas fa-chevron-up"></i>
            </button>
        </div>
        <div class="weather-content">
            <div>INTENSITY</div>
            <input type="range" min="0" max="100" value="50" class="weather-slider" id="weatherSlider">
            <div>TYPE: <span id="weatherType">SNOW</span></div>
            <div class="weather-buttons">
                <button class="weather-btn active" data-weather="snow">SNOW</button>
                <button class="weather-btn" data-weather="rain">RAIN</button>
                <button class="weather-btn" data-weather="fog">FOG</button>
                <button class="weather-btn" data-weather="storm">STORM</button>
            </div>
        </div>
    </div>
    
    <!-- BOAT CONTROL PANEL -->
    <div class="boat-control">
        <div>BOAT CONTROL</div>
        <div class="control-buttons">
            <button class="control-btn" id="boatForward"><i class="fas fa-arrow-up"></i></button>
            <button class="control-btn" id="boatBoost"><i class="fas fa-bolt"></i></button>
            <button class="control-btn" id="boatBackward"><i class="fas fa-arrow-down"></i></button>
            <button class="control-btn" id="boatLeft"><i class="fas fa-arrow-left"></i></button>
            <button class="control-btn" id="boatCenter"><i class="fas fa-bullseye"></i></button>
            <button class="control-btn" id="boatRight"><i class="fas fa-arrow-right"></i></button>
        </div>
        <div class="speed-value" id="currentSpeed">75</div>
        <div>KM/H CURRENT</div>
    </div>
    
    <!-- SHOP WINDOW -->
    <div class="shop-toggle" id="shopToggleBtn">
        <i class="fas fa-shopping-bag"></i> SHOP
    </div>
    <div class="shop-window" id="shopWindow">
        <h2 style="font-family:'Orbitron';margin-bottom:1.5rem;color:#00f0ff">NFT FASHION</h2>
        
        <div class="nft-item">
            <h3 style="font-family:'Orbitron'">CYBER JACKET</h3>
            <p>Limited edition with NFC chip</p>
            <div class="nft-price">0.15 ETH</div>
            <button class="btn btn-primary" style="width:100%" onclick="buyProduct('cyber-jacket')">
                BUY NOW
            </button>
        </div>
        
        <div class="nft-item">
            <h3 style="font-family:'Orbitron'">RIVER RUNNERS</h3>
            <p>Water-resistant smart shoes</p>
            <div class="nft-price">0.08 ETH</div>
            <button class="btn btn-primary" style="width:100%" onclick="buyProduct('river-runners')">
                BUY NOW
            </button>
        </div>
        
        <div class="nft-item">
            <h3 style="font-family:'Orbitron'">DIGITAL CAPE</h3>
            <p>AR-enabled wearable</p>
            <div class="nft-price">0.25 ETH</div>
            <button class="btn btn-primary" style="width:100%" onclick="buyProduct('digital-cape')">
                BUY NOW
            </button>
        </div>
    </div>

    <script>
        // PRELOADER
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('preloader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('preloader').style.display = 'none';
                    initScene();
                    createSnowflakes();
                    setupTouchControls();
                    setupWeatherToggle();
                }, 500);
            }, 3000);
        });

        // THREE.JS SCENE
        let scene, camera, renderer, composer;
        let boat, river, cityBuildings = [];
        let particles = [];
        let particleCount = 2500;
        let boatSpeed = 75;
        let distanceTraveled = 0;
        let riverWidth = 100;
        let riverLength = 500;
        let boatPositionX = 0;
        let boatPositionZ = 0;
        let boatHeight = -3;
        let clock = new THREE.Clock();
        let riverMaterial, waterTexture;
        let particleGeometry, particleMaterial, particleSystem;
        let lightParticles = [];
        let fogParticles = [];
        let controls;
        let nitroActive = false;
        let speedBoost = 1;
        let weatherType = 'snow';
        let weatherIntensity = 0.5;
        let buildings = [];
        let riverDirection = 1;
        let boatVelocity = 0;
        let isMobile = false;
        let touchJoystickActive = false;
        let joystickX = 0, joystickY = 0;
        let touchSpeedActive = false;
        let speedValue = 0.5;

        function initScene() {
            // Detect mobile device
            isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // SCENE SETUP
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x001133, 50, 300);
            
            // CAMERA - adjusted for mobile
            camera = new THREE.PerspectiveCamera(
                isMobile ? 70 : 60, 
                window.innerWidth / window.innerHeight, 
                0.1, 
                2000
            );
            camera.position.set(0, 30, 60);
            camera.lookAt(0, 0, 0);
            
            // RENDERER
            renderer = new THREE.WebGLRenderer({ 
                antialias: true, 
                alpha: true,
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobile ? 1.5 : 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // POST-PROCESSING - disable on mobile for performance
            if (!isMobile) {
                composer = new THREE.EffectComposer(renderer);
                const renderPass = new THREE.RenderPass(scene, camera);
                composer.addPass(renderPass);
                
                const fxaaPass = new THREE.ShaderPass(THREE.FXAAShader);
                fxaaPass.uniforms['resolution'].value.set(1 / window.innerWidth, 1 / window.innerHeight);
                composer.addPass(fxaaPass);
            }
            
            // CONTROLS
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 30;
            controls.maxDistance = 200;
            controls.maxPolarAngle = Math.PI / 2.5;
            
            // Disable orbit controls on mobile touch
            if (isMobile) {
                controls.enableZoom = false;
                controls.enablePan = false;
                controls.enableRotate = false;
            }
            
            // LIGHTING
            const ambientLight = new THREE.AmbientLight(0x334466, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0x88aaff, 0.9);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 1024;
            directionalLight.shadow.mapSize.height = 1024;
            directionalLight.shadow.camera.left = -100;
            directionalLight.shadow.camera.right = 100;
            directionalLight.shadow.camera.top = 100;
            directionalLight.shadow.camera.bottom = -100;
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0x00ffff, 0.8, 200);
            pointLight.position.set(0, 20, 0);
            scene.add(pointLight);
            
            const hemisphereLight = new THREE.HemisphereLight(0x4488ff, 0x002266, 0.5);
            scene.add(hemisphereLight);
            
            // CREATE SCENE ELEMENTS
            createRiver();
            createPremiumSpeedBoat();
            createWeatherParticles();
            createCity();
            createLightParticles();
            createFogParticles();
            
            // SETUP CONTROLS
            setupControls();
            setupUIControls();
            
            // START ANIMATION
            animate();
            
            // WINDOW RESIZE
            window.addEventListener('resize', onWindowResize);
        }

        // ====== PREMIUM SPEED BOAT WITH REAL ENGINE ======
        function createPremiumSpeedBoat() {
            const boatGroup = new THREE.Group();
            
            // Main hull - aerodynamic speedboat design
            const hullGeometry = new THREE.CylinderGeometry(2, 3, 12, 16, 1, false, 0, Math.PI);
            const hullMaterial = new THREE.MeshPhysicalMaterial({ 
                color: 0x001a33,
                emissive: 0x002244,
                emissiveIntensity: 0.8,
                metalness: 0.95,
                roughness: 0.05,
                clearcoat: 1.0,
                clearcoatRoughness: 0.1,
                reflectivity: 1.0
            });
            const hull = new THREE.Mesh(hullGeometry, hullMaterial);
            hull.rotation.z = Math.PI / 2;
            hull.rotation.x = Math.PI / 2;
            hull.castShadow = true;
            boatGroup.add(hull);
            
            // Sleek deck
            const deckGeometry = new THREE.BoxGeometry(10, 0.8, 5);
            const deckMaterial = new THREE.MeshPhysicalMaterial({ 
                color: 0x111122,
                metalness: 0.95,
                roughness: 0.05,
                clearcoat: 1.0
            });
            const deck = new THREE.Mesh(deckGeometry, deckMaterial);
            deck.position.set(0, 1.5, 0);
            deck.castShadow = true;
            boatGroup.add(deck);
            
            // Cockpit with futuristic glass
            const cockpitGeometry = new THREE.BoxGeometry(4, 2.5, 3.5);
            const cockpitMaterial = new THREE.MeshPhysicalMaterial({ 
                color: 0x001122,
                transparent: true,
                opacity: 0.3,
                transmission: 0.8,
                roughness: 0.1,
                metalness: 0.9,
                clearcoat: 1.0,
                clearcoatRoughness: 0.1
            });
            const cockpit = new THREE.Mesh(cockpitGeometry, cockpitMaterial);
            cockpit.position.set(0, 3, 1.5);
            cockpit.castShadow = true;
            boatGroup.add(cockpit);
            
            // ====== REALISTIC ENGINE SYSTEM ======
            const engineGroup = new THREE.Group();
            
            // Engine block
            const engineGeometry = new THREE.CylinderGeometry(1.2, 1.5, 5, 12);
            const engineMaterial = new THREE.MeshPhysicalMaterial({ 
                color: 0x222222,
                emissive: 0x333333,
                emissiveIntensity: 0.5,
                metalness: 0.95,
                roughness: 0.1,
                clearcoat: 1.0
            });
            const engine = new THREE.Mesh(engineGeometry, engineMaterial);
            engine.position.set(0, 2, -4);
            engineGroup.add(engine);
            
            // Engine exhaust pipes
            const exhaustGeometry = new THREE.CylinderGeometry(0.2, 0.3, 2, 8);
            const exhaustMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x444444,
                emissive: 0xff3300,
                emissiveIntensity: 0.3,
                metalness: 0.9,
                roughness: 0.2
            });
            
            for(let i = 0; i < 2; i++) {
                const exhaust = new THREE.Mesh(exhaustGeometry, exhaustMaterial);
                exhaust.position.set(-0.5 + i * 1, 2.5, -5.5);
                exhaust.rotation.x = Math.PI / 4;
                engineGroup.add(exhaust);
            }
            
            // Cooling fins
            const finGeometry = new THREE.BoxGeometry(2, 0.1, 0.8);
            const finMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x555555,
                metalness: 0.8,
                roughness: 0.3
            });
            
            for(let i = 0; i < 4; i++) {
                const fin = new THREE.Mesh(finGeometry, finMaterial);
                fin.position.set(0, 2.2 + i * 0.2, -4);
                engineGroup.add(fin);
            }
            
            // Propeller system
            const propellerGroup = new THREE.Group();
            
            // Propeller hub
            const hubGeometry = new THREE.CylinderGeometry(0.5, 0.5, 0.8, 8);
            const hubMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x888888,
                metalness: 0.9,
                roughness: 0.1
            });
            const hub = new THREE.Mesh(hubGeometry, hubMaterial);
            hub.position.set(0, 2, -6);
            propellerGroup.add(hub);
            
            // Propeller blades
            const bladeGeometry = new THREE.BoxGeometry(0.1, 2, 0.3);
            const bladeMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xaaaaaa,
                metalness: 0.8,
                roughness: 0.2
            });
            
            for(let i = 0; i < 3; i++) {
                const blade = new THREE.Mesh(bladeGeometry, bladeMaterial);
                blade.rotation.z = (Math.PI * 2 / 3) * i;
                blade.position.set(0, 2, -6);
                propellerGroup.add(blade);
            }
            
            engineGroup.add(propellerGroup);
            boatGroup.add(engineGroup);
            
            // Engine glow effects
            const engineGlow = new THREE.PointLight(0xff3300, 3, 40);
            engineGlow.position.set(0, 2, -5);
            boatGroup.add(engineGlow);
            
            // Engine exhaust particles light
            const exhaustLight = new THREE.PointLight(0xff5500, 2, 25);
            exhaustLight.position.set(0, 2, -6);
            boatGroup.add(exhaustLight);
            
            // Navigation lights
            const leftLight = new THREE.PointLight(0x00ff00, 2, 20);
            leftLight.position.set(-2.5, 2.5, 4);
            boatGroup.add(leftLight);
            
            const rightLight = new THREE.PointLight(0xff0000, 2, 20);
            rightLight.position.set(2.5, 2.5, 4);
            boatGroup.add(rightLight);
            
            // Neon accents
            const neonGeometry = new THREE.BoxGeometry(8, 0.1, 0.3);
            const neonMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x9d00ff,
                emissive: 0x9d00ff,
                emissiveIntensity: 2,
                transparent: true,
                opacity: 0.8
            });
            
            const neonStrip = new THREE.Mesh(neonGeometry, neonMaterial);
            neonStrip.position.set(0, 1.6, 2);
            boatGroup.add(neonStrip);
            
            // Hydrofoils/wings
            const wingGeometry = new THREE.BoxGeometry(6, 0.4, 2);
            const wingMaterial = new THREE.MeshPhysicalMaterial({ 
                color: 0x00aaff,
                metalness: 0.9,
                roughness: 0.1,
                clearcoat: 1.0
            });
            
            const leftWing = new THREE.Mesh(wingGeometry, wingMaterial);
            leftWing.position.set(-4, 0, 0);
            leftWing.rotation.z = -0.3;
            boatGroup.add(leftWing);
            
            const rightWing = new THREE.Mesh(wingGeometry, wingMaterial);
            rightWing.position.set(4, 0, 0);
            rightWing.rotation.z = 0.3;
            boatGroup.add(rightWing);
            
            // Rudder
            const rudderGeometry = new THREE.BoxGeometry(0.4, 2, 1.5);
            const rudderMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x333333,
                metalness: 0.8,
                roughness: 0.2
            });
            
            const rudder = new THREE.Mesh(rudderGeometry, rudderMaterial);
            rudder.position.set(0, 0.5, -5);
            boatGroup.add(rudder);
            
            boat = boatGroup;
            boat.position.set(0, boatHeight, 0);
            boat.castShadow = true;
            scene.add(boat);
            
            // Add propeller animation property
            boat.userData = {
                propellerRotation: 0
            };
            
            console.log("⚡ Premium Speed Boat created with realistic engine system");
        }

        function createRiver() {
            const riverGeometry = new THREE.PlaneGeometry(riverWidth, riverLength, 100, 200);
            
            // Advanced water material
            waterTexture = new THREE.TextureLoader().load('https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80');
            waterTexture.wrapS = waterTexture.wrapT = THREE.RepeatWrapping;
            waterTexture.repeat.set(10, 20);
            
            riverMaterial = new THREE.ShaderMaterial({
                uniforms: {
                    time: { value: 0 },
                    waterTexture: { value: waterTexture },
                    color1: { value: new THREE.Color(0x002288) },
                    color2: { value: new THREE.Color(0x0044cc) },
                    iceColor: { value: new THREE.Color(0xaaccff) },
                    speed: { value: 0.5 },
                    snowAmount: { value: 0.3 }
                },
                vertexShader: `
                    varying vec2 vUv;
                    varying vec3 vPosition;
                    uniform float time;
                    void main() {
                        vUv = uv;
                        vPosition = position;
                        vec3 pos = position;
                        pos.x += sin(pos.y * 0.5 + time) * 0.5;
                        pos.z += cos(pos.x * 0.3 + time * 0.7) * 0.3;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform vec3 color1;
                    uniform vec3 color2;
                    uniform vec3 iceColor;
                    uniform float time;
                    uniform float speed;
                    uniform float snowAmount;
                    uniform sampler2D waterTexture;
                    varying vec2 vUv;
                    varying vec3 vPosition;
                    
                    void main() {
                        float wave = sin(vUv.x * 10.0 + time * speed) * 0.5 + 0.5;
                        vec3 waterColor = mix(color1, color2, wave);
                        
                        float edgeFactor = 1.0 - abs(vUv.x - 0.5) * 2.0;
                        float iceFactor = smoothstep(0.7, 1.0, edgeFactor) * snowAmount;
                        
                        float snowPattern = sin(vUv.x * 50.0 + time) * 0.5 + 0.5;
                        snowPattern *= sin(vUv.y * 30.0 + time * 0.5) * 0.5 + 0.5;
                        float snowFactor = iceFactor * snowPattern * 0.3;
                        
                        vec3 finalColor = mix(waterColor, iceColor, iceFactor);
                        finalColor = mix(finalColor, vec3(1.0, 1.0, 1.0), snowFactor);
                        
                        vec4 texColor = texture2D(waterTexture, vUv * 2.0 + time * 0.01);
                        finalColor = mix(finalColor, finalColor * texColor.rgb, 0.3);
                        
                        float alpha = 0.9 - abs(vUv.x - 0.5) * 0.5;
                        alpha = min(alpha, 1.0 - iceFactor * 0.3);
                        
                        gl_FragColor = vec4(finalColor, alpha);
                    }
                `,
                transparent: true,
                side: THREE.DoubleSide
            });
            
            river = new THREE.Mesh(riverGeometry, riverMaterial);
            river.rotation.x = -Math.PI / 2;
            river.position.y = -5;
            scene.add(river);
            
            // Create river banks
            const bankGeometry = new THREE.BoxGeometry(riverWidth + 20, 6, riverLength);
            const bankMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x334455,
                roughness: 0.9,
                metalness: 0.1
            });
            
            const leftBank = new THREE.Mesh(bankGeometry, bankMaterial);
            leftBank.position.set(-(riverWidth/2 + 10), -8, 0);
            leftBank.receiveShadow = true;
            scene.add(leftBank);
            
            const rightBank = new THREE.Mesh(bankGeometry, bankMaterial);
            rightBank.position.set(riverWidth/2 + 10, -8, 0);
            rightBank.receiveShadow = true;
            scene.add(rightBank);
        }

        function createWeatherParticles() {
            // Reduce particle count on mobile
            const count = isMobile ? 1000 : particleCount;
            
            particleGeometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            
            for(let i = 0; i < count; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 200;
                positions[i * 3 + 1] = Math.random() * 100 + 50;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 500;
                
                colors[i * 3] = 1.0;
                colors[i * 3 + 1] = 1.0;
                colors[i * 3 + 2] = 1.0;
            }
            
            particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            particleGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            particleMaterial = new THREE.PointsMaterial({
                size: isMobile ? 0.5 : 0.8,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });
            
            particleSystem = new THREE.Points(particleGeometry, particleMaterial);
            scene.add(particleSystem);
        }

        function createCity() {
            // Reduce building count on mobile
            const buildingCount = isMobile ? 40 : 80;
            
            for(let i = 0; i < buildingCount; i++) {
                const buildingGroup = new THREE.Group();
                
                const buildingHeight = Math.random() * 40 + 20;
                const buildingWidth = Math.random() * 8 + 5;
                const buildingDepth = Math.random() * 8 + 5;
                
                const buildingGeometry = new THREE.BoxGeometry(buildingWidth, buildingHeight, buildingDepth);
                const buildingMaterial = new THREE.MeshStandardMaterial({ 
                    color: 0x112244,
                    emissive: 0x001133,
                    emissiveIntensity: 0.3,
                    metalness: 0.8,
                    roughness: 0.3
                });
                
                const building = new THREE.Mesh(buildingGeometry, buildingMaterial);
                building.castShadow = true;
                building.receiveShadow = true;
                buildingGroup.add(building);
                
                // Position building
                const side = Math.random() > 0.5 ? 1 : -1;
                buildingGroup.position.set(
                    (riverWidth/2 + 40 + Math.random() * 60) * side,
                    buildingHeight/2 - 5,
                    (Math.random() - 0.5) * riverLength
                );
                
                scene.add(buildingGroup);
                buildings.push(buildingGroup);
            }
        }

        function createLightParticles() {
            const count = isMobile ? 800 : 1500;
            const geometry = new THREE.BufferGeometry();
            const positions = new Float32Array(count * 3);
            const colors = new Float32Array(count * 3);
            
            for(let i = 0; i < count; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 200;
                positions[i * 3 + 1] = Math.random() * 50;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 500;
                
                colors[i * 3] = 0.2 + Math.random() * 0.3;
                colors[i * 3 + 1] = 0.5 + Math.random() * 0.5;
                colors[i * 3 + 2] = 1.0;
            }
            
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: isMobile ? 0.4 : 0.6,
                vertexColors: true,
                transparent: true,
                opacity: 0.4,
                blending: THREE.AdditiveBlending
            });
            
            const particles = new THREE.Points(geometry, material);
            scene.add(particles);
            lightParticles.push(particles);
        }

        function createFogParticles() {
            const fogCount = isMobile ? 400 : 800;
            const fogGeometry = new THREE.BufferGeometry();
            const positions = new Float32Array(fogCount * 3);
            
            for(let i = 0; i < fogCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 100;
                positions[i * 3 + 1] = Math.random() * 20 - 10;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 500;
            }
            
            fogGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const fogMaterial = new THREE.PointsMaterial({
                color: 0xaaccff,
                size: isMobile ? 6 : 8,
                transparent: true,
                opacity: 0.08,
                blending: THREE.AdditiveBlending
            });
            
            const fog = new THREE.Points(fogGeometry, fogMaterial);
            scene.add(fog);
            fogParticles.push(fog);
        }

        function setupControls() {
            const keys = {};
            
            // Keyboard controls
            document.addEventListener('keydown', (e) => {
                keys[e.code] = true;
                
                if(e.code === 'Space') {
                    activateNitro();
                }
            });
            
            document.addEventListener('keyup', (e) => {
                keys[e.code] = false;
            });
            
            // Update boat based on keys
            function updateBoatFromKeys() {
                // Left/Right
                if(keys['ArrowLeft'] || keys['KeyA']) {
                    boatPositionX = Math.max(boatPositionX - 0.8, -riverWidth/2 + 5);
                }
                if(keys['ArrowRight'] || keys['KeyD']) {
                    boatPositionX = Math.min(boatPositionX + 0.8, riverWidth/2 - 5);
                }
                
                // Forward/Backward
                if(keys['ArrowUp'] || keys['KeyW']) {
                    boatPositionZ -= boatSpeed * 0.02 * speedBoost;
                    boatVelocity = -boatSpeed * speedBoost;
                    riverDirection = -1;
                }
                if(keys['ArrowDown'] || keys['KeyS']) {
                    boatPositionZ += boatSpeed * 0.02 * speedBoost;
                    boatVelocity = boatSpeed * speedBoost;
                    riverDirection = 1;
                }
                
                // Speed adjustment
                if(keys['Equal'] || keys['NumpadAdd']) {
                    boatSpeed = Math.min(boatSpeed + 2, 200);
                }
                if(keys['Minus'] || keys['NumpadSubtract']) {
                    boatSpeed = Math.max(boatSpeed - 2, 10);
                }
                
                updateUI();
            }
            
            // Integrate into animation loop
            window.updateControls = function() {
                updateBoatFromKeys();
                
                // Update from touch joystick if active
                if (touchJoystickActive) {
                    boatPositionX += joystickX * 2;
                    boatPositionX = Math.max(-riverWidth/2 + 5, Math.min(riverWidth/2 - 5, boatPositionX));
                    
                    boatPositionZ -= joystickY * boatSpeed * 0.03 * speedBoost;
                    boatVelocity = -joystickY * boatSpeed * speedBoost;
                    riverDirection = joystickY > 0 ? -1 : 1;
                }
                
                // Update from touch speed control
                if (touchSpeedActive) {
                    boatSpeed = 10 + speedValue * 190;
                }
            };
        }

        function setupUIControls() {
            // Boat control buttons
            document.getElementById('boatForward').addEventListener('click', () => moveBoatForward());
            document.getElementById('boatBackward').addEventListener('click', () => moveBoatBackward());
            document.getElementById('boatLeft').addEventListener('click', () => moveBoatLeft());
            document.getElementById('boatRight').addEventListener('click', () => moveBoatRight());
            document.getElementById('boatCenter').addEventListener('click', () => centerBoat());
            document.getElementById('boatBoost').addEventListener('click', () => activateNitro());
            
            // Speed control
            document.getElementById('speedUp').addEventListener('click', () => {
                boatSpeed = Math.min(boatSpeed + 25, 200);
                speedBoost = 1.5;
                setTimeout(() => speedBoost = 1, 1000);
                updateUI();
            });
            
            // Weather controls
            document.getElementById('weatherSlider').addEventListener('input', (e) => {
                weatherIntensity = e.target.value / 100;
                document.getElementById('weatherIntensity').textContent = Math.floor(weatherIntensity * 5000);
                
                if(particleMaterial) {
                    particleMaterial.opacity = 0.3 + weatherIntensity * 0.7;
                    particleMaterial.size = 0.5 + weatherIntensity * 1.0;
                }
            });
            
            // Weather type buttons
            document.querySelectorAll('.weather-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.weather-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    weatherType = this.dataset.weather;
                    document.getElementById('weatherType').textContent = weatherType.toUpperCase();
                    
                    if(particleMaterial) {
                        if(weatherType === 'snow') {
                            particleMaterial.color.set(0xffffff);
                        } else if(weatherType === 'rain') {
                            particleMaterial.color.set(0x00aaff);
                        } else if(weatherType === 'fog') {
                            particleMaterial.color.set(0xaaccff);
                        } else if(weatherType === 'storm') {
                            particleMaterial.color.set(0x666666);
                        }
                    }
                });
            });
        }

        function setupWeatherToggle() {
            const weatherControl = document.getElementById('weatherControl');
            const weatherToggleBtn = document.getElementById('weatherToggleBtn');
            const weatherToggleIcon = weatherToggleBtn.querySelector('i');
            
            weatherToggleBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                weatherControl.classList.toggle('minimized');
                
                if (weatherControl.classList.contains('minimized')) {
                    weatherToggleIcon.className = 'fas fa-chevron-down';
                } else {
                    weatherToggleIcon.className = 'fas fa-chevron-up';
                }
            });
            
            // Also allow clicking header to toggle
            document.getElementById('weatherToggle').addEventListener('click', () => {
                weatherControl.classList.toggle('minimized');
                
                if (weatherControl.classList.contains('minimized')) {
                    weatherToggleIcon.className = 'fas fa-chevron-down';
                } else {
                    weatherToggleIcon.className = 'fas fa-chevron-up';
                }
            });
        }

        function setupTouchControls() {
            const joystick = document.getElementById('touchJoystick');
            const joystickHandle = document.getElementById('joystickHandle');
            const speedControl = document.getElementById('touchSpeedControl');
            const speedSlider = document.getElementById('speedSlider');
            
            let joystickRect, speedRect;
            let joystickCenterX, joystickCenterY;
            let speedMinY, speedMaxY;
            
            function updateJoystickPosition() {
                joystickRect = joystick.getBoundingClientRect();
                joystickCenterX = joystickRect.left + joystickRect.width / 2;
                joystickCenterY = joystickRect.top + joystickRect.height / 2;
            }
            
            function updateSpeedControlPosition() {
                speedRect = speedControl.getBoundingClientRect();
                speedMinY = speedRect.top + 35;
                speedMaxY = speedRect.bottom - 35;
            }
            
            // Update positions on load and resize
            updateJoystickPosition();
            updateSpeedControlPosition();
            window.addEventListener('resize', () => {
                updateJoystickPosition();
                updateSpeedControlPosition();
            });
            
            // Touch events for joystick
            joystick.addEventListener('touchstart', handleJoystickStart);
            document.addEventListener('touchmove', handleJoystickMove);
            document.addEventListener('touchend', handleJoystickEnd);
            
            // Mouse events for testing
            joystick.addEventListener('mousedown', handleJoystickStart);
            document.addEventListener('mousemove', handleJoystickMove);
            document.addEventListener('mouseup', handleJoystickEnd);
            
            // Speed control touch events
            speedControl.addEventListener('touchstart', handleSpeedStart);
            document.addEventListener('touchmove', handleSpeedMove);
            document.addEventListener('touchend', handleSpeedEnd);
            
            // Mouse events for speed control
            speedControl.addEventListener('mousedown', handleSpeedStart);
            document.addEventListener('mousemove', handleSpeedMove);
            document.addEventListener('mouseup', handleSpeedEnd);
            
            function handleJoystickStart(e) {
                e.preventDefault();
                touchJoystickActive = true;
                updateJoystickPosition();
                handleJoystickMove(e);
            }
            
            function handleJoystickMove(e) {
                if (!touchJoystickActive) return;
                
                let clientX, clientY;
                
                if (e.type.includes('touch')) {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                // Calculate joystick position
                const deltaX = clientX - joystickCenterX;
                const deltaY = clientY - joystickCenterY;
                
                // Limit joystick movement to circle
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                const maxDistance = 50;
                
                if (distance > maxDistance) {
                    joystickX = (deltaX / distance) * maxDistance;
                    joystickY = (deltaY / distance) * maxDistance;
                } else {
                    joystickX = deltaX;
                    joystickY = deltaY;
                }
                
                // Normalize values
                joystickX = joystickX / maxDistance;
                joystickY = joystickY / maxDistance;
                
                // Update joystick visual position
                joystickHandle.style.transform = `translate(calc(-50% + ${joystickX * maxDistance}px), calc(-50% + ${joystickY * maxDistance}px))`;
            }
            
            function handleJoystickEnd() {
                touchJoystickActive = false;
                joystickX = 0;
                joystickY = 0;
                joystickHandle.style.transform = 'translate(-50%, -50%)';
            }
            
            function handleSpeedStart(e) {
                e.preventDefault();
                touchSpeedActive = true;
                updateSpeedControlPosition();
                handleSpeedMove(e);
            }
            
            function handleSpeedMove(e) {
                if (!touchSpeedActive) return;
                
                let clientY;
                
                if (e.type.includes('touch')) {
                    clientY = e.touches[0].clientY;
                } else {
                    clientY = e.clientY;
                }
                
                // Calculate speed based on slider position
                const sliderY = Math.max(speedMinY, Math.min(speedMaxY, clientY));
                const speedPercent = 1 - (sliderY - speedMinY) / (speedMaxY - speedMinY);
                
                // Set boat speed (10-200 range)
                speedValue = speedPercent;
                boatSpeed = 10 + speedPercent * 190;
                
                // Update slider position
                speedSlider.style.top = `${10 + speedPercent * 100}px`;
                
                updateUI();
            }
            
            function handleSpeedEnd() {
                touchSpeedActive = false;
            }
            
            // Gesture hints
            setTimeout(() => {
                document.getElementById('gestureHint').style.opacity = '0.7';
                setTimeout(() => {
                    document.getElementById('gestureHint').style.opacity = '0.3';
                }, 5000);
            }, 2000);
        }

        function moveBoatForward() {
            boatPositionZ -= boatSpeed * 0.05 * speedBoost;
            boatVelocity = -boatSpeed * speedBoost;
            riverDirection = -1;
            updateUI();
        }
        
        function moveBoatBackward() {
            boatPositionZ += boatSpeed * 0.05 * speedBoost;
            boatVelocity = boatSpeed * speedBoost;
            riverDirection = 1;
            updateUI();
        }
        
        function moveBoatLeft() {
            boatPositionX = Math.max(boatPositionX - 10, -riverWidth/2 + 5);
            updateUI();
        }
        
        function moveBoatRight() {
            boatPositionX = Math.min(boatPositionX + 10, riverWidth/2 + 5);
            updateUI();
        }
        
        function centerBoat() {
            boatPositionX = 0;
            updateUI();
        }
        
        function activateNitro() {
            nitroActive = true;
            speedBoost = 2.5;
            setTimeout(() => {
                nitroActive = false;
                speedBoost = 1;
            }, 2000);
            updateUI();
        }
        
        function updateUI() {
            document.getElementById('boatSpeed').textContent = Math.floor(boatSpeed);
            document.getElementById('currentSpeed').textContent = Math.floor(boatSpeed * speedBoost);
            document.getElementById('riverPosition').textContent = `Z: ${boatPositionZ.toFixed(1)}`;
            
            const directionArrow = document.getElementById('directionArrow');
            if(riverDirection === -1) {
                directionArrow.textContent = '↑';
                directionArrow.style.color = '#00ff9d';
            } else {
                directionArrow.textContent = '↓';
                directionArrow.style.color = '#00f0ff';
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            
            const delta = clock.getDelta();
            const time = clock.getElapsedTime();
            
            // Update controls
            if (window.updateControls) updateControls();
            
            // Update river material
            if(riverMaterial && riverMaterial.uniforms) {
                riverMaterial.uniforms.time.value = time;
                riverMaterial.uniforms.speed.value = Math.abs(boatVelocity) * 0.01;
                riverMaterial.uniforms.snowAmount.value = weatherIntensity * 0.5;
            }
            
            // Move weather particles
            if(particleSystem && particleSystem.geometry) {
                const positions = particleSystem.geometry.attributes.position.array;
                
                for(let i = 0; i < positions.length; i += 3) {
                    if(weatherType === 'snow') {
                        positions[i + 1] -= 1.5 * weatherIntensity;
                        positions[i] += Math.sin(time + positions[i + 2] * 0.01) * 0.1;
                    } else if(weatherType === 'rain') {
                        positions[i + 1] -= 4 * weatherIntensity;
                    } else if(weatherType === 'fog') {
                        positions[i + 1] -= 0.5 * weatherIntensity;
                        positions[i] += Math.sin(time * 0.5 + positions[i + 2] * 0.01) * 0.05;
                    } else if(weatherType === 'storm') {
                        positions[i + 1] -= 3 * weatherIntensity;
                        positions[i] += Math.sin(time * 2 + positions[i + 2] * 0.01) * 0.2;
                    }
                    
                    if(positions[i + 1] < -50) {
                        positions[i] = (Math.random() - 0.5) * 200;
                        positions[i + 1] = Math.random() * 100 + 50;
                        positions[i + 2] = (Math.random() - 0.5) * 500;
                    }
                }
                
                particleSystem.geometry.attributes.position.needsUpdate = true;
            }
            
            // Update boat animation
            if(boat) {
                boat.position.x += (boatPositionX - boat.position.x) * 0.1;
                boat.position.z += (boatPositionZ - boat.position.z) * 0.1;
                
                boat.position.y = boatHeight + Math.sin(time * 2 + boat.position.z * 0.01) * 0.5;
                
                boat.rotation.z = (boatPositionX - boat.position.x) * 0.03;
                boat.rotation.x = Math.sin(time) * 0.05 + (boatVelocity / 200) * 0.2;
                boat.rotation.y = riverDirection * 0.05;
                
                // Animate propeller
                if (boat.userData) {
                    boat.userData.propellerRotation += boatSpeed * 0.1;
                    const propeller = boat.children.find(child => child.name === 'engineSystem');
                    if (propeller) {
                        const propellerPart = propeller.children.find(child => child.type === 'Group');
                        if (propellerPart) {
                            propellerPart.rotation.y = boat.userData.propellerRotation;
                        }
                    }
                }
                
                distanceTraveled += Math.abs(boatVelocity) * delta * 0.001;
                document.getElementById('distance').textContent = distanceTraveled.toFixed(1);
                
                if(Math.abs(boatVelocity) > 10 && time % 0.3 < 0.1) {
                    createWakeParticle();
                }
            }
            
            // Update camera to follow boat
            camera.position.x += (boat.position.x * 0.5 - camera.position.x) * 0.05;
            camera.position.z = boat.position.z + (isMobile ? 40 : 60);
            camera.position.y = (isMobile ? 25 : 30) + Math.sin(time) * 2;
            
            camera.lookAt(boat.position.x, boat.position.y + 5, boat.position.z);
            
            controls.update();
            
            // Render with or without post-processing
            if (composer && !isMobile) {
                composer.render();
            } else {
                renderer.render(scene, camera);
            }
        }

        function createWakeParticle() {
            const wakeGeometry = new THREE.RingGeometry(1, 3, 16);
            const wakeMaterial = new THREE.MeshBasicMaterial({
                color: nitroActive ? 0xff3300 : (riverDirection === -1 ? 0x00ff9d : 0x00ffff),
                transparent: true,
                opacity: 0.4,
                side: THREE.DoubleSide
            });
            
            const wake = new THREE.Mesh(wakeGeometry, wakeMaterial);
            wake.position.set(boat.position.x, -4.9, boat.position.z);
            wake.rotation.x = -Math.PI / 2;
            scene.add(wake);
            
            let scale = 1;
            let opacity = 0.4;
            
            function animateWake() {
                scale += 0.8;
                opacity -= 0.03;
                
                wake.scale.set(scale, scale, 1);
                wakeMaterial.opacity = opacity;
                
                if(opacity > 0) {
                    requestAnimationFrame(animateWake);
                } else {
                    scene.remove(wake);
                    wakeMaterial.dispose();
                    wakeGeometry.dispose();
                }
            }
            
            animateWake();
        }

        function createSnowflakes() {
            const snowflakesContainer = document.getElementById('snowflakes');
            const snowflakeCount = isMobile ? 50 : 150;
            
            for(let i = 0; i < snowflakeCount; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                
                const size = Math.random() * 5 + 2;
                snowflake.style.width = `${size}px`;
                snowflake.style.height = `${size}px`;
                
                snowflake.style.left = `${Math.random() * 100}vw`;
                snowflake.style.top = `${Math.random() * 100}vh`;
                
                snowflake.style.opacity = Math.random() * 0.7 + 0.3;
                
                const duration = Math.random() * 10 + 10;
                const delay = Math.random() * 5;
                
                snowflake.style.animation = `fall ${duration}s linear ${delay}s infinite`;
                
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes fall {
                        0% {
                            transform: translateY(-100px) translateX(0px) rotate(0deg);
                            opacity: ${snowflake.style.opacity};
                        }
                        100% {
                            transform: translateY(100vh) translateX(${Math.random() * 200 - 100}px) rotate(360deg);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
                
                snowflakesContainer.appendChild(snowflake);
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            if (composer) {
                composer.setSize(window.innerWidth, window.innerHeight);
            }
        }

        // UI CONTROLS
        document.getElementById('shopToggle').addEventListener('click', () => {
            document.getElementById('shopWindow').classList.add('active');
        });

        document.getElementById('shopToggleBtn').addEventListener('click', () => {
            document.getElementById('shopWindow').classList.toggle('active');
        });

        document.getElementById('connectWallet').addEventListener('click', function() {
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> CONNECTING...';
            this.style.opacity = '0.8';
            
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-check"></i> CONNECTED';
                this.style.background = 'linear-gradient(45deg, #00ff9d, #00f0ff)';
                
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.style.opacity = '1';
                    this.style.background = 'linear-gradient(45deg, #00f0ff, #9d00ff)';
                }, 3000);
            }, 1500);
        });

        function buyProduct(product) {
            alert(`Purchasing ${product.toUpperCase()}...\n\nRedirecting to checkout.`);
        }
        
        // ====== ENHANCED SEO FEATURES ======
        // Update page title dynamically based on interaction
        window.addEventListener('focus', () => {
            document.title = "BURΔQ | Cyber River Fashion - Premium Phygital Fashion & NFT Wearables";
        });
        
        window.addEventListener('blur', () => {
            document.title = "Come back to BURΔQ | Cyber River Fashion";
        });
        
        // Track user engagement for analytics
        let engagementTime = 0;
        setInterval(() => {
            engagementTime++;
            if (engagementTime === 30) {
                console.log("User engaged for 30 seconds - high quality session");
            }
        }, 1000);
        
        // Performance monitoring
        if ('performance' in window) {
            setTimeout(() => {
                const loadTime = performance.now();
                console.log(`Page loaded in ${loadTime.toFixed(2)}ms`);
                
                if (loadTime > 3000) {
                    console.warn("Load time exceeds 3 seconds - consider optimization");
                }
            }, 1000);
        }
        
        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(() => {
                    console.log('Service Worker registered');
                }).catch(err => {
                    console.log('Service Worker registration failed: ', err);
                });
            });
        }
        
        // Web App Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button after 10 seconds
            setTimeout(() => {
                const installBtn = document.createElement('button');
                installBtn.innerHTML = '<i class="fas fa-download"></i> Install App';
                installBtn.className = 'btn btn-primary';
                installBtn.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    z-index: 1000;
                    animation: float 3s ease-in-out infinite;
                `;
                
                installBtn.onclick = async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        if (outcome === 'accepted') {
                            installBtn.remove();
                        }
                    }
                };
                
                document.body.appendChild(installBtn);
            }, 10000);
        });
    </script>
</body>
</html>
